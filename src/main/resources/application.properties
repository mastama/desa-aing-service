# ===== App =====
spring.application.name=desa-aing-service
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
server.port=${SERVER_PORT:8080}
# Time zone utk Clock/serializer (sesuai milikmu)
app.time-zone=${APP_TIMEZONE:Asia/Jakarta}
spring.jackson.time-zone=${APP_TIMEZONE:Asia/Jakarta}
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

service.id=${SERVICE_ID:00000}

# SECURITY
spring.security.user.name=admin
spring.security.user.password=admin

# ===== JPA / DataSource (pakai host 'postgres' di dalam compose) =====
spring.datasource.url=jdbc:postgresql://${DATABASE_URL:localhost}:${DATABASE_PORT:5432}/${DATABASE_NAME:postgres}
spring.datasource.username=${DATABASE_USERNAME:mastama}
spring.datasource.password=${DATABASE_PASSWORD:post456}
spring.datasource.type=com.zaxxer.hikari.HikariDataSource
spring.jpa.database=POSTGRESQL
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=true
# Pastikan Hibernate tidak membuat skema sendiri
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.jdbc.temp.use_jdbc_metadata_defaults=false

# Hikari
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.minimum-idle=${HIKARI_MINIMUM_IDLE:2}
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAXIMUM_POOL:5}
spring.datasource.hikari.connection-timeout=${HIKARI_CONNECTION_TIMEOUT:15000}
spring.datasource.hikari.idle-timeout=${HIKARI_IDLE_TIMEOUT:300000}
spring.datasource.hikari.max-lifetime=${HIKARI_MAX_LIFETIME:900000}
spring.datasource.hikari.pool-name=${HIKARI_POOL_NAME:approval-model-pool}
spring.datasource.hikari.auto-commit=${HIKARI_AUTO_COMMIT:true}

# ===== Redis (pakai host 'redis' di dalam compose) =====
spring.data.redis.host=${REDIS_HOST:127.0.0.1}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=${REDIS_POOL_TIMEOUT:100}
spring.data.redis.jedis.pool.max-active=${REDIS_POOL_MAXACTIVE:256}
spring.data.redis.jedis.pool.max-idle=${REDIS_POOL_MAXIDLE:12}
spring.data.redis.jedis.pool.max-wait=${REDIS_POOL_MAXWAIT:100}
spring.data.redis.jedis.pool.min-idle=${REDIS_POOL_MINIDLE:6}
spring.data.redis.repositories.enabled=${REDIS_REPOSITORIES:true}

# ===== Logging =====
logging.level.root=INFO
logging.level.org.springframework.web=INFO

# ===== JWT =====
# ===== JWT (RS256) =====
jwt.issuer=desa-aing-service
# 10 menit
jwt.access-ttl-seconds=600
# 14 hari
jwt.refresh-ttl-seconds=1209600

# Disarankan via ENV (multiline PEM)
jwt.private-key-path=${JWT_PRIVATE_PATH:classpath:key/private_pkcs8.pem}
jwt.public-key-path=${JWT_PUBLIC_PATH:classpath:key/public.pem}

# Aktifkan Flyway
spring.flyway.enabled=true
spring.flyway.locations=classpath:db.migration
spring.flyway.default-schema=public
spring.flyway.schemas=public
# Pastikan Hibernate tidak membuat skema sendiri
# Keamanan & ketertiban migration (disarankan)
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true

# Kalau DB Anda SUDAH berisi tabel (legacy), aktifkan baseline:
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0




